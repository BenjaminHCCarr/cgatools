<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>cgatools: cgatools::mapping::MergedMap2SamConverter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacecgatools.html">cgatools</a>::<b>mapping</b>::<a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html">MergedMap2SamConverter</a>
  </div>
</div>
<div class="contents">
<h1>cgatools::mapping::MergedMap2SamConverter Class Reference</h1><!-- doxytag: class="cgatools::mapping::MergedMap2SamConverter" --><!-- doxytag: inherits="cgatools::mapping::Map2SamConverter" --><div class="dynheader">
Inheritance diagram for cgatools::mapping::MergedMap2SamConverter:</div>
<div class="dynsection">
 <div class="center">
  <img src="classcgatools_1_1mapping_1_1MergedMap2SamConverter.png" usemap="#cgatools::mapping::MergedMap2SamConverter_map" alt=""/>
  <map id="cgatools::mapping::MergedMap2SamConverter_map" name="cgatools::mapping::MergedMap2SamConverter_map">
<area href="classcgatools_1_1mapping_1_1Map2SamConverter.html" alt="cgatools::mapping::Map2SamConverter" shape="rect" coords="0,0,275,24"/>
</map>
 </div>
</div>

<p><a href="classcgatools_1_1mapping_1_1MergedMap2SamConverter-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0310d2f51c31cbac6d24ade9e0865109"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::MappingIndicesBySide" ref="a0310d2f51c31cbac6d24ade9e0865109" args="" -->
typedef boost::array<br class="typebreak"/>
&lt; std::vector&lt; size_t &gt;, 2 &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>MappingIndicesBySide</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc24dd6d53a483a956434a003aa3e1e1"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::MappingWeightsBySide" ref="afc24dd6d53a483a956434a003aa3e1e1" args="" -->
typedef boost::array<br class="typebreak"/>
&lt; std::vector&lt; double &gt;, 2 &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>MappingWeightsBySide</b></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4b24630d3abc382ee52c70d4198a7a09"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::MergedMap2SamConverter" ref="a4b24630d3abc382ee52c70d4198a7a09" args="(const MergedMap2SamConfig &amp;config, std::ostream &amp;outSamFile)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>MergedMap2SamConverter</b> (const <a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConfig.html">MergedMap2SamConfig</a> &amp;config, std::ostream &amp;outSamFile)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad5a1bb7eb2a591fcbbd6415ccf7ce0fd"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::init" ref="ad5a1bb7eb2a591fcbbd6415ccf7ce0fd" args="()" -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><b>init</b> ()</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a869f6e38e2a0aa872b2c308472ea1234"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::processMappings" ref="a869f6e38e2a0aa872b2c308472ea1234" args="(const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;samMappings, const mapping::MappingsRecords &amp;baseMappingRecords) const " -->
virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a869f6e38e2a0aa872b2c308472ea1234">processMappings</a> (const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;samMappings, const mapping::MappingsRecords &amp;baseMappingRecords) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">override the method to merge the evidence mappings <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1d65a041dae09c350cf15213da71e195"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::writeMappingRecord" ref="a1d65a041dae09c350cf15213da71e195" args="(const SamRecord &amp;m) const " -->
virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a1d65a041dae09c350cf15213da71e195">writeMappingRecord</a> (const <a class="el" href="classcgatools_1_1mapping_1_1SamRecord.html">SamRecord</a> &amp;m) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Export mapping record in SAM format. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a456286ccc78f7e9db191730277f70b3f"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::addEvidenceRecords" ref="a456286ccc78f7e9db191730277f70b3f" args="(const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;records) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a456286ccc78f7e9db191730277f70b3f">addEvidenceRecords</a> (const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;records) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Merge evidence records into the base mappings. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac989e59b4780cf4bdd3f601536006763"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::regroupMappings" ref="ac989e59b4780cf4bdd3f601536006763" args="(const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;records) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#ac989e59b4780cf4bdd3f601536006763">regroupMappings</a> (const mapping::ReadsRecord &amp;readsRecord, SamRecordArray &amp;records) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process merged mappings: recompute MAPQ, deduplicate, select best mapping pairs. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1c5ef977537296c61e42bb8b72f71aa3"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::computeMappingWeights" ref="a1c5ef977537296c61e42bb8b72f71aa3" args="(const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappings, MappingWeightsBySide &amp;weights) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a1c5ef977537296c61e42bb8b72f71aa3">computeMappingWeights</a> (const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappings, MappingWeightsBySide &amp;weights) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes P(DNBs) * P(gaps) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1970ad5423caaf0c16ea9f2a9c870774"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::filterDuplicatedMappings" ref="a1970ad5423caaf0c16ea9f2a9c870774" args="(SamRecordArray &amp;records) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a1970ad5423caaf0c16ea9f2a9c870774">filterDuplicatedMappings</a> (SamRecordArray &amp;records) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">filter the mappings that have equal position and alignment, leave Evidence mappings if equal to base <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a536881c4be036d009a72911641d2fc36"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::computeWeightMatrix" ref="a536881c4be036d009a72911641d2fc36" args="(const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappings, const MappingWeightsBySide &amp;weights, DoubleMatrix &amp;weightMatrix, DoubleMatrix &amp;mateGaps) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>computeWeightMatrix</b> (const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappings, const MappingWeightsBySide &amp;weights, DoubleMatrix &amp;weightMatrix, DoubleMatrix &amp;mateGaps) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaa01cf8b7417e6b8efd14ec1df63d091"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::computeTotalWeight" ref="aaa01cf8b7417e6b8efd14ec1df63d091" args="(const DoubleMatrix &amp;weightMatrix, MappingWeightsBySide &amp;sumAllPairs) const " -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>computeTotalWeight</b> (const DoubleMatrix &amp;weightMatrix, MappingWeightsBySide &amp;sumAllPairs) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5a5dea8706fc0ab447d4be932e2087de"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::findBestCandidates" ref="a5a5dea8706fc0ab447d4be932e2087de" args="(const DoubleMatrix &amp;m, const DoubleMatrix &amp;mateGaps, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;sumAllPairs, MappingIndicesBySide &amp;bestGroupMappings, MappingIndicesBySide &amp;groups) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>findBestCandidates</b> (const DoubleMatrix &amp;m, const DoubleMatrix &amp;mateGaps, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;sumAllPairs, MappingIndicesBySide &amp;bestGroupMappings, MappingIndicesBySide &amp;groups) const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a29135f54881e0a44ea5be44c222792dd"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::reweightSingleMappings" ref="a29135f54881e0a44ea5be44c222792dd" args="(SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;dnbArmWeights, const MappingWeightsBySide &amp;sumAllPairs) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a29135f54881e0a44ea5be44c222792dd">reweightSingleMappings</a> (SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;dnbArmWeights, const MappingWeightsBySide &amp;sumAllPairs) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">compute weights of double arm mappings and detect primary mappings for each group <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adf9777d0eee3051bbd28951b02941099"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::reweightDoubleArmMappings" ref="adf9777d0eee3051bbd28951b02941099" args="(SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const DoubleMatrix &amp;weightMatrix, const DoubleMatrix &amp;mateGapFrequency, const MappingWeightsBySide &amp;sumAllPairs, const MappingIndicesBySide &amp;bestFullMappedArms, const MappingIndicesBySide &amp;groups, const double &amp;totalWeight) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#adf9777d0eee3051bbd28951b02941099">reweightDoubleArmMappings</a> (SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const DoubleMatrix &amp;weightMatrix, const DoubleMatrix &amp;mateGapFrequency, const MappingWeightsBySide &amp;sumAllPairs, const MappingIndicesBySide &amp;bestFullMappedArms, const MappingIndicesBySide &amp;groups, const double &amp;totalWeight) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">compute weights of single arm mappings <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a50c41779051bcf2a6d636aab8414aa9f"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::detectTheBestMappingAndMakeItPrimary" ref="a50c41779051bcf2a6d636aab8414aa9f" args="(SamRecordArray &amp;records) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a50c41779051bcf2a6d636aab8414aa9f">detectTheBestMappingAndMakeItPrimary</a> (SamRecordArray &amp;records) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the function selects the best mapping record based on MAPQ set by reweightDoubleArmMappings <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44bc6f78838021c6c95a4c272e0e2f3a"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::dumpBestLocalMatches" ref="a44bc6f78838021c6c95a4c272e0e2f3a" args="(const mapping::ReadsRecord &amp;readsRecord, const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;dnbArmWeights, const DoubleMatrix &amp;weights, const DoubleMatrix &amp;mateGaps, const MappingWeightsBySide &amp;sumAllPairs, const MappingIndicesBySide &amp;bestFullMappedArms, const MappingIndicesBySide &amp;groups, const double &amp;totalWeight) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConverter.html#a44bc6f78838021c6c95a4c272e0e2f3a">dumpBestLocalMatches</a> (const mapping::ReadsRecord &amp;readsRecord, const SamRecordArray &amp;records, const MappingIndicesBySide &amp;mappingsBySide, const MappingWeightsBySide &amp;dnbArmWeights, const DoubleMatrix &amp;weights, const DoubleMatrix &amp;mateGaps, const MappingWeightsBySide &amp;sumAllPairs, const MappingIndicesBySide &amp;bestFullMappedArms, const MappingIndicesBySide &amp;groups, const double &amp;totalWeight) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">output debug information to stdout <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a296841d6614c765281499c4c74cd2228"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::printMatrix" ref="a296841d6614c765281499c4c74cd2228" args="(const DoubleMatrix &amp;m, std::ostream &amp;ostr) const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>printMatrix</b> (const DoubleMatrix &amp;m, std::ostream &amp;ostr) const </td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad9dc245b6142025fe996f26fedd15113"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::config_" ref="ad9dc245b6142025fe996f26fedd15113" args="" -->
const <a class="el" href="classcgatools_1_1mapping_1_1MergedMap2SamConfig.html">MergedMap2SamConfig</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><b>config_</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1b2cb3b9d0b385a2c4063ac12972c4cd"></a><!-- doxytag: member="cgatools::mapping::MergedMap2SamConverter::evidenceBatchRecords_" ref="a1b2cb3b9d0b385a2c4063ac12972c4cd" args="" -->
mapping::BatchRecords&nbsp;</td><td class="memItemRight" valign="bottom"><b>evidenceBatchRecords_</b></td></tr>
</table>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="MergeMap2SamConverter_8hpp_source.html">MergeMap2SamConverter.hpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
